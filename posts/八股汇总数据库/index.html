<!DOCTYPE html>
<html lang="zh_CN"><head>
    <meta charset="utf-8"><title>八股汇总｜数据库&nbsp;-&nbsp;XUN</title>

    <meta name="theme-color" content="#e0e0e0">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="msapplication-navbutton-color" content="#e0e0e0">
    <meta name="apple-mobile-web-app-status-bar-style" content="#e0e0e0">
    
    
    <link rel="icon" type="image/png" href="/HQL.ico">
    
    
    
     
    
    <link rel="stylesheet" href="https://cenjianxun.github.io/scss/main.min.e5295e285c64657d4f07ae8c8ebf5825bc5ecf38f1250bc775257874f6cd1a4f.css">
    
    
    <script type="text/javascript" src="/js/main.js" defer></script>
</head><body class="mytheme">
  <div class="body-container">
    <aside>
    <div class="nav-title">
        <a href="/" target="_blank">XUN</a>
    </div>
    <section class="sidebar">
        <div id="sidebar-info" class="sidebar-info">
            <div class="sidebar-about">
                <p class="lead">
                    想写一个播放器想写一个传输工具想写一个通讯工具想在高速公路上自由coding一边听歌如果一个古代人技能点是写代码怎么办
                </p>
            </div>
            <div class="count">文章</div>
            <div class="social">
                <a href="https://github.com/cenjianxun" target="_blank" rel="noopener noreferrer">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-github">
                        <path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/>
                        <path d="M9 18c-4.51 2-5-2-7-2"/> 
                        </svg>
                </a>
                <a href="" target="_blank" rel="noopener noreferrer">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor"  stroke-linecap="round" stroke-linejoin="round"
                        class="lucide lucide-twitter">
                        <path
                            d="M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z">
                        </path>
                    </svg>
                </a>
                <a href=""  target="_blank" rel="noopener noreferrer">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                        class="lucide lucide-mail">
                        <rect width="20" height="16" x="2" y="4" rx="2"></rect>
                        <path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"></path>
                    </svg>
                </a>
                <a href=""  target="_blank" rel="noopener noreferrer">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                        class="lucide lucide-rss">
                        <path d="M4 11a9 9 0 0 1 9 9"></path>
                        <path d="M4 4a16 16 0 0 1 16 16"></path>
                        <circle cx="5" cy="19" r="1"></circle>
                    </svg>
                </a>
            </div>
        </div>
        
        
            

<div id="sidebar-toc" class="sidebar-toc">
    
    <header>
        <span class="toc-bar"></span>
        <h4 class="toc-header">八股汇总｜数据库</h4>
        <span class="toc-bar"></span>
    </header>
    
    <nav id="TableOfContents">
  <ul>
    <li><a href="#myisam和innodb">myisam和innodb</a></li>
    <li><a href="#数据库索引">数据库索引</a>
      <ul>
        <li><a href="#innodb为什么用b">innoDB为什么用B+</a></li>
        <li><a href="#索引使用">索引使用</a></li>
        <li><a href="#索引优化">索引优化</a></li>
      </ul>
    </li>
    <li><a href="#聚簇索引--非聚簇索引">聚簇索引 &amp; 非聚簇索引</a></li>
    <li><a href="#数据库的并发控制保持一致性问题">数据库的并发控制，保持一致性问题</a>
      <ul>
        <li><a href="#事务一系列逻辑操作">事务：一系列逻辑操作</a></li>
        <li><a href="#并发一致性问题">并发一致性问题：</a>
          <ul>
            <li><a href="#mvcc">MVCC：</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#死锁活锁和饥饿">死锁，活锁和饥饿</a></li>
    <li><a href="#回滚--rollback">回滚 ｜ rollback</a></li>
  </ul>
</nav>
</div>
 


<script type="text/javascript" src="/js/toc.js" defer></script>




        

    </section>
    <section class="func">
        <div id="func-top" class="to-top">
            <a href="#top" target="_self">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 28 28" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                    class="lucide lucide-arrow-big-up-dash">
                    <path d="M9 19h6" />
                    <path d="M9 15v-3H5l7-7 7 7h-4v3H9z" />
                </svg>
            </a>
        </div>
    </section>
</aside>
    <div class="content-container">
      <nav class="nav-container">
    <div class="nav-title">
        <a href="/" target="_blank">XUN</a>
    </div>
    <button type="button" class="drop-menu-button">
        <span class="menu-bar"></span>
        <span class="menu-bar"></span>
        <span class="menu-bar"></span>
    </button>
    <ul class="nav-menu-items"><li class="menu-item">
            <a href="/" target="_self">HOME</a>
        </li><li class="menu-item">
            <a href="/archive/" target="_self">ARCHIVE</a>
        </li><li class="menu-item">
            <a href="/notes/" target="_self">NOTES</a>
        </li><li class="menu-item">
            <a href="/about/" target="_self">ABOUT</a>
        </li>
    </ul>


</nav>
      <main class="content">
        <div class="page"><article class="post-block">
    <header class="post-header">
        <h1>八股汇总｜数据库</h1>
        <div class="post-time">Jun 22 2019</div>
    </header>

    
    <div class="post-content"><p>一些基础概念。</p>
<h2 id="myisam和innodb">myisam和innodb <a href="#myisam%e5%92%8cinnodb" style="border:none;"></a></h2><p>innodb：支持事务， 有外键， b+treey叶子是data，聚簇索引要有主键，不存表行，记录存内存</p>
<p>myisam：不支持事务，无外键，叶子是point，非聚簇索引，存表行，记录存磁盘</p>
<h2 id="数据库索引">数据库索引 <a href="#%e6%95%b0%e6%8d%ae%e5%ba%93%e7%b4%a2%e5%bc%95" style="border:none;"></a></h2><ul>
<li>分类<br>
按物理：聚簇索引，非聚簇索引<br>
按数据结构：B+，hash，全文索引， R-tree<br>
按逻辑：主键索引，唯一索引，组合索引，全文索引，普通索引</li>
</ul>
<h3 id="innodb为什么用b">innoDB为什么用B+ <a href="#innodb%e4%b8%ba%e4%bb%80%e4%b9%88%e7%94%a8b" style="border:none;"></a></h3><p>→ 二叉树：高度较高 &amp; B+树比较次数少 ，I/O少，速度快。O（logN）</p>
<p>→ hash: hash乱序，不支持范围查询、模糊查询和索引排序;有hash碰撞所以不稳定</p>
<p>→ 红黑树：可能退化成链表。加数据时还是会增加高度，对大量数据不友好。需要高度增加不快的树</p>
<p>→ B树: （百万量也可能只三到五层）</p>
<p>① Btree非叶子节点都存数据，B+只在叶子节点存数据，单个节点数据量小，一次I/O可得到更多节点</p>
<p>② B+叶子节点之间双链表连接，可实现范围、顺序查找。</p>
<h3 id="索引使用">索引使用 <a href="#%e7%b4%a2%e5%bc%95%e4%bd%bf%e7%94%a8" style="border:none;"></a></h3><ul>
<li>适用：唯一性限制的字段。常用于where、group by、order by的字</li>
<li>不需要的：where group order无的 | 数据量少 | 重复多的 | 经常更新的</li>
<li>失效情况：在B+上查询时不能确定进一步子叶以缩小范围的情况：
<ul>
<li>like以%开头索引无效</li>
<li>计算、函数、比较，not，&lt;&gt;，!=索引无效</li>
<li>字符串不加引号导致类型转换</li>
<li>联合索引时没最左</li>
<li>在索引列上使用 IS NULL 或 IS NOT NULL操作</li>
</ul>
</li>
</ul>
<h3 id="索引优化">索引优化 <a href="#%e7%b4%a2%e5%bc%95%e4%bc%98%e5%8c%96" style="border:none;"></a></h3><p>回表：查询了非主键列，会先检索辅助索引的B+tree，找到主键值，再通过主键index获取整行。</p>
<ul>
<li>建立前缀索引：对某字段文本的前几个字符建立索引。<br>
减少索引大小。order by无法用</li>
<li>覆盖索引：建立要查的所有列的索引。不用查整行，不用回表，减少I/O</li>
<li>联合索引：最左匹配。<br>
· 区分度大的放最前<br>
· index有序 where后的可无序但一定要有最左列<br>
· 第一个&gt;的本人可命中索引，之后的不命中</li>
</ul>
<h2 id="聚簇索引--非聚簇索引">聚簇索引 &amp; 非聚簇索引 <a href="#%e8%81%9a%e7%b0%87%e7%b4%a2%e5%bc%95--%e9%9d%9e%e8%81%9a%e7%b0%87%e7%b4%a2%e5%bc%95" style="border:none;"></a></h2><ul>
<li>
<p>聚簇索引： 顺序就是数据的物理存储顺序</p>
<p>聚簇索引的叶节点就是数据节点</p>
</li>
<li>
<p>非聚簇索引：索引顺序与数据物理排列顺序无关，逻辑上连续，物理存储并不连续</p>
<p>非聚簇索引的叶节点是指向数据节点的地址</p>
</li>
</ul>
<p>聚簇索引的唯一性：<br>
　　　正式聚簇索引的顺序就是数据的物理存储顺序，所以一个表最多只能有一个聚簇索引，因为物理存储只能有一个顺序。正因为一个表最多只能有一个聚簇索引，所以它显得更为珍贵，一个表设置什么为聚簇索引对性能很关键。</p>
<h2 id="数据库的并发控制保持一致性问题">数据库的并发控制，保持一致性问题 <a href="#%e6%95%b0%e6%8d%ae%e5%ba%93%e7%9a%84%e5%b9%b6%e5%8f%91%e6%8e%a7%e5%88%b6%e4%bf%9d%e6%8c%81%e4%b8%80%e8%87%b4%e6%80%a7%e9%97%ae%e9%a2%98" style="border:none;"></a></h2><h3 id="事务一系列逻辑操作">事务：一系列逻辑操作 <a href="#%e4%ba%8b%e5%8a%a1%e4%b8%80%e7%b3%bb%e5%88%97%e9%80%bb%e8%be%91%e6%93%8d%e4%bd%9c" style="border:none;"></a></h3><p>特性：<br>
Atomicity，Isolation，Consistency，Durability</p>
<p>实现：<br>
Atomicity —— redolog<br>
Isolation —— MVCC 锁<br>
Consistency —— undolog<br>
Durability —— redo log</p>
<h3 id="并发一致性问题">并发一致性问题： <a href="#%e5%b9%b6%e5%8f%91%e4%b8%80%e8%87%b4%e6%80%a7%e9%97%ae%e9%a2%98" style="border:none;"></a></h3><p>并发环境下，因为事务的隔离性很难保证，所以会出现很多并发问题</p>
<p>隔离级别：</p>
<ul>
<li>读未提交  发生下面所有</li>
<li>读已提交  解决： dirty read： A还没提交写，B就读了</li>
<li>可重复读  解决： unrepeateable read： 一个事务内A改了，B读了两次不一样B没提交<br>
= 串行化  解决： phantom read：范围之间多插了一条</li>
</ul>
<p>实现：</p>
<ul>
<li>串行化：加读写锁</li>
<li>读提交 &amp; 可重复读：Read View。 like snapshot</li>
<li>读提交：每个语句执行前生成snapshot</li>
<li>可重复读：启动事务时生成一个 Read View。由MVCC实现</li>
</ul>
<h4 id="mvcc">MVCC： <a href="#mvcc" style="border:none;"></a></h4><p>读：旧版本快照<br>
写：新版本+version</p>
<p>Innodb 引擎为了解决「可重复读」隔离级别使用「当前读」而造成的幻读问题，就引出了 next-key 锁<br>
“</p>
<p>next-key锁 = 记录锁+间隙锁</p>
<ul>
<li>记录锁，锁的是记录本身；</li>
<li>间隙锁，锁的就是两个值之间的空隙，以防止其他事务在这个空隙间插入新的数据，从而避免幻读现象。</li>
</ul>
<h2 id="死锁活锁和饥饿">死锁，活锁和饥饿 <a href="#%e6%ad%bb%e9%94%81%e6%b4%bb%e9%94%81%e5%92%8c%e9%a5%a5%e9%a5%bf" style="border:none;"></a></h2><blockquote>
<p>There may be more than one process competing for a limited amount of resources in a multiprogramming environment. If a process requests a resource that is not currently available, the process will wait until the resource becomes available. In some cases, the waiting process may not gain access to the resource, resulting in deadlock, livelock, and starvation.<br>
- Deadlock: Processes can become stuck in a deadlock when they can&rsquo;t acquire resources and stop advancing as each of them waits to get the resource held by the other process.<br>
- Livelock: In a livelock, the state of the processes involved changes constantly. This is a deadlock-like situation where processes block each other by changing their states repeatedly and yet do not progress.<br>
- Starvation: Starvation occurs when a process does not have regular access to the resources needed to complete its task and so becomes unable to perform any work. All the low priority processes get blocked, while the high priority ones continue.</p>
</blockquote>
<p>死锁不能自行解开，活锁和饥饿可以</p>
<p>死锁一直等待，活锁可能不断改变状态</p>
<h2 id="回滚--rollback">回滚 ｜ rollback <a href="#%e5%9b%9e%e6%bb%9a--rollback" style="border:none;"></a></h2><blockquote>
<p>In SQL, a rollback can be defined as the process of restoring a database to its previous state if there has been an error during the execution of a transaction. A rollback can either be performed automatically by a database system or manually by an end-user. The rollback function brings a transaction back to the beginning or undo any changes since the last COMMIT. Additionally, it releases resources used by the transaction</p>
</blockquote>
<p>Commit vs Rollback</p>
<blockquote>
<p>COMMIT is applied after a successful transaction.<br>
ROLLBACK statements in SQL are used to undo unfinished transactions in the database.<br>
A COMMIT statement in SQL is used to permanently save the changes made during a transaction in a table/database.In case of an error during transaction execution, this command will restore the database to its previous state.</p>
</blockquote></div>

    <div class="post-meta meta">
        

        <span class="tags-box">
            <svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 512 512" fill="currentColor"
                class="fas-tags">
                <path
                    d="M345 39.1L472.8 168.4c52.4 53 52.4 138.2 0 191.2L360.8 472.9c-9.3 9.4-24.5 9.5-33.9 .2s-9.5-24.5-.2-33.9L438.6 325.9c33.9-34.3 33.9-89.4 0-123.7L310.9 72.9c-9.3-9.4-9.2-24.6 .2-33.9s24.6-9.2 33.9 .2zM0 229.5V80C0 53.5 21.5 32 48 32H197.5c17 0 33.3 6.7 45.3 18.7l168 168c25 25 25 65.5 0 90.5L277.3 442.7c-25 25-65.5 25-90.5 0l-168-168C6.7 262.7 0 246.5 0 229.5zM144 144a32 32 0 1 0 -64 0 32 32 0 1 0 64 0z" />
            </svg>
            
            
            <a class="tag-link" href="/%20/tags/database">DataBase</a>
            
            ,&nbsp;
            <a class="tag-link" href="/%20/tags/%E5%85%AB%E8%82%A1">八股</a>
            
        </span>
        
    </div>

    <div class="post-paginator">
        
        
        <span class="pag-prev">
            
            
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"
                class="lucide lucide-arrow-left-from-line">
                <path d="M3 19V5" />
                <path d="m13 6-6 6 6 6" />
                <path d="M7 12h14" />
            </svg>
            </svg>
            <a href="https://cenjianxun.github.io/posts/%E5%85%AB%E8%82%A1%E6%B1%87%E6%80%BB%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" class="jump-post">八股汇总｜计算机网络</a>
            
        </span>

        <span class="pag-next">
            
            
            <a href="https://cenjianxun.github.io/posts/%E5%85%AB%E8%82%A1%E6%B1%87%E6%80%BBredis/" class="jump-post">八股汇总｜redis</a>
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"
                class="lucide lucide-arrow-right-to-line">
                <path d="M17 12H3" />
                <path d="m11 18 6-6-6-6" />
                <path d="M21 5v14" />
            </svg>
            
        </span>

    </div>

    

</article>


    </div>
      </main>
      <footer class="footer">
    <p> © 2018 - 2024 &nbsp; XUN
    </p>
</footer>


    </div>
  </div>
</body>
</html>